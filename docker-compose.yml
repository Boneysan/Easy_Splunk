# ============================================================================
# GENERATED COMPOSE FILE - DO NOT EDIT MANUALLY
# -----------------------------------------------------------------------------
# Generated by: deploy.sh
# Generated at: 2025-09-15T19:05:34Z UTC
# Compose Engine: docker
# Engine Version: Docker Compose version v2.39.1
# Schema Version: 3.8
# Validation: PASSED
# -----------------------------------------------------------------------------
# This file was generated for docker with schema version 3.8.
# If you encounter compatibility issues, verify your compose engine version.
# ============================================================================

# ============================================================================
# GENERATED COMPOSE FILE - DO NOT EDIT MANUALLY
# -----------------------------------------------------------------------------
# Generated by: deploy.sh
# Generated at: 2025-09-09T18:59:42Z UTC
# Compose Engine: docker
# Engine Version: Docker Compose version v2.39.2
# Schema Version: 3.8
# Validation: PASSED
# -----------------------------------------------------------------------------
# This file was generated for docker with schema version 3.8.
# If you encounter compatibility issues, verify your compose engine version.
# ============================================================================

# ============================================================================
# GENERATED COMPOSE FILE - DO NOT EDIT MANUALLY
# -----------------------------------------------------------------------------
# Generated by: deploy.sh
# Generated at: 2025-09-08T21:30:37Z UTC
# Compose Engine: docker
# Engine Version: Docker Compose version v2.39.1
# Schema Version: 3.8
# Validation: PASSED
# -----------------------------------------------------------------------------
# This file was generated for docker with schema version 3.8.
# If you encounter compatibility issues, verify your compose engine version.
# ============================================================================

# ============================================================================
# GENERATED COMPOSE FILE - DO NOT EDIT MANUALLY
# -----------------------------------------------------------------------------
# Generated by: deploy.sh
# Generated at: 2025-09-03T19:47:05Z UTC
# Compose Engine: docker
# Engine Version: Docker Compose version v2.39.1
# Schema Version: 3.8
# Validation: PASSED
# -----------------------------------------------------------------------------
# This file was generated for docker with schema version 3.8.
# If you encounter compatibility issues, verify your compose engine version.
# ============================================================================

# ============================================================================
# GENERATED COMPOSE FILE - DO NOT EDIT MANUALLY
# -----------------------------------------------------------------------------
# Generated by: deploy.sh
# Generated at: 2025-09-03T18:37:54Z UTC
# Compose Engine: docker
# Engine Version: Docker Compose version v2.39.1
# Schema Version: 3.8
# Validation: PASSED
# -----------------------------------------------------------------------------
# This file was generated for docker with schema version 3.8.
# If you encounter compatibility issues, verify your compose engine version.
# ============================================================================

# ============================================================================
# GENERATED COMPOSE FILE - DO NOT EDIT MANUALLY
# -----------------------------------------------------------------------------
# Generated by: deploy.sh
# Generated at: 2025-09-03T18:34:50Z UTC
# Compose Engine: docker
# Engine Version: Docker Compose version v2.39.1
# Schema Version: 3.8
# Validation: PASSED
# -----------------------------------------------------------------------------
# This file was generated for docker with schema version 3.8.
# If you encounter compatibility issues, verify your compose engine version.
# ============================================================================

# ============================================================================
# GENERATED COMPOSE FILE - DO NOT EDIT MANUALLY
# -----------------------------------------------------------------------------
# Generated by: deploy.sh
# Generated at: 2025-09-03T18:17:36Z UTC
# Compose Engine: docker
# Engine Version: Docker Compose version v2.39.1
# Schema Version: 3.8
# Validation: PASSED
# -----------------------------------------------------------------------------
# This file was generated for docker with schema version 3.8.
# If you encounter compatibility issues, verify your compose engine version.
# ============================================================================

# ============================================================================
# GENERATED COMPOSE FILE - DO NOT EDIT MANUALLY
# -----------------------------------------------------------------------------
# Generated by: deploy.sh
# Generated at: 2025-09-03T18:15:17Z UTC
# Compose Engine: docker
# Engine Version: Docker Compose version v2.39.1
# Schema Version: 3.8
# Validation: PASSED
# -----------------------------------------------------------------------------
# This file was generated for docker with schema version 3.8.
# If you encounter compatibility issues, verify your compose engine version.
# ============================================================================

# ============================================================================
# GENERATED COMPOSE FILE - DO NOT EDIT MANUALLY
# -----------------------------------------------------------------------------
# Generated by: deploy.sh
# Generated at: 2025-09-03T15:09:22Z UTC
# Compose Engine: docker
# Engine Version: Docker Compose version v2.39.1
# Schema Version: 3.8
# Validation: PASSED
# -----------------------------------------------------------------------------
# This file was generated for docker with schema version 3.8.
# If you encounter compatibility issues, verify your compose engine version.
# ============================================================================

# ============================================================================
# GENERATED COMPOSE FILE - DO NOT EDIT MANUALLY
# -----------------------------------------------------------------------------
# Generated by: deploy.sh
# Generated at: 2025-09-03T15:08:24Z UTC
# Compose Engine: docker
# Engine Version: Docker Compose version v2.39.1
# Schema Version: 3.8
# Validation: PASSED
# -----------------------------------------------------------------------------
# This file was generated for docker with schema version 3.8.
# If you encounter compatibility issues, verify your compose engine version.
# ============================================================================

# ============================================================================
# GENERATED COMPOSE FILE - DO NOT EDIT MANUALLY
# -----------------------------------------------------------------------------
# Generated by: deploy.sh
# Generated at: 2025-09-03T15:07:33Z UTC
# Compose Engine: docker
# Engine Version: Docker Compose version v2.39.1
# Schema Version: 3.8
# Validation: PASSED
# -----------------------------------------------------------------------------
# This file was generated for docker with schema version 3.8.
# If you encounter compatibility issues, verify your compose engine version.
# ============================================================================

# ============================================================================
# GENERATED COMPOSE FILE - DO NOT EDIT MANUALLY
# -----------------------------------------------------------------------------
# Generated by: deploy.sh
# Generated at: 2025-09-03T15:06:41Z UTC
# Compose Engine: docker
# Engine Version: Docker Compose version v2.39.1
# Schema Version: 3.8
# Validation: PASSED
# -----------------------------------------------------------------------------
# This file was generated for docker with schema version 3.8.
# If you encounter compatibility issues, verify your compose engine version.
# ============================================================================

# ============================================================================
# GENERATED COMPOSE FILE - DO NOT EDIT MANUALLY
# -----------------------------------------------------------------------------
# Generated by: deploy.sh
# Generated at: 2025-09-03T15:01:23Z UTC
# Compose Engine: docker
# Engine Version: Docker Compose version v2.39.1
# Schema Version: 3.8
# Validation: PASSED
# -----------------------------------------------------------------------------
# This file was generated for docker with schema version 3.8.
# If you encounter compatibility issues, verify your compose engine version.
# ============================================================================

# ============================================================================
# GENERATED COMPOSE FILE - DO NOT EDIT MANUALLY
# -----------------------------------------------------------------------------
# Generated by: deploy.sh
# Generated at: 2025-09-03T09:43:00Z UTC
# Compose Engine: docker
# Engine Version: Docker Compose version v2.39.1
# Schema Version: 3.8
# Validation: PASSED
# -----------------------------------------------------------------------------
# This file was generated for docker with schema version 3.8.
# If you encounter compatibility issues, verify your compose engine version.
# ============================================================================

# ------------------------------------------------------------------------------
# Auto-generated by lib/compose-generator.sh
# Generated on: 2025-09-03 09:43:00 UTC
# Runtime: docker
# Compose: docker compose
# Do not edit this file manually; it will be overwritten.
# ------------------------------------------------------------------------------
# Compose Specification (https://compose-spec.io/)

services:
  # Splunk Cluster Master
  splunk-cm:
    image: "${SPLUNK_IMAGE}"
    container_name: "${COMPOSE_PROJECT_NAME:-splunk}_cluster_master"
    hostname: "splunk-cm"
    restart: unless-stopped
    ports:
      - "8089:8089"  # Management port
    environment:
      SPLUNK_START_ARGS: "--accept-license --answer-yes"
      SPLUNK_GENERAL_TERMS: "--accept-sgt-current-at-splunk-com"
      SPLUNK_ROLE: "splunk_cluster_master"
      SPLUNK_CLUSTER_MASTER_URL: "https://splunk-cm:8089"
      SPLUNK_PASSWORD: "${SPLUNK_PASSWORD}"
      SPLUNK_SECRET: "${SPLUNK_SECRET}"
      SPLUNK_REPLICATION_FACTOR: "1"
      SPLUNK_SEARCH_FACTOR: "1"
    networks:
      - splunk-net
    volumes:
      - splunk-cm-etc:/opt/splunk/etc
      - splunk-cm-var:/opt/splunk/var
    profiles: ["splunk", "small", "medium", "large"]
    healthcheck:
      test: ["CMD-SHELL", "curl -k -f https://localhost:8089/services/server/info >/dev/null 2>&1 || test $? -eq 22"]
      interval: 30s
      timeout: 10s
      retries: 10
      start_period: 180s
    deploy:
      resources:
        limits:
          cpus: '${SPLUNK_CM_CPU_LIMIT:-1.0}'
          memory: '${SPLUNK_CM_MEM_LIMIT:-1G}'
        reservations:
          cpus: '${SPLUNK_CM_CPU_RESERVE:-0.5}'
          memory: '${SPLUNK_CM_MEM_RESERVE:-512M}'
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "5"
  # Splunk Indexer 1
  splunk-idx1:
    image: "${SPLUNK_IMAGE}"
    container_name: "${COMPOSE_PROJECT_NAME:-splunk}_splunk-idx1"
    hostname: "splunk-idx1"
    restart: unless-stopped
    environment:
      SPLUNK_START_ARGS: "--accept-license --answer-yes"
      SPLUNK_GENERAL_TERMS: "--accept-sgt-current-at-splunk-com"
      SPLUNK_ROLE: "splunk_indexer"
      SPLUNK_CLUSTER_MASTER_URL: "https://splunk-cm:8089"
      SPLUNK_INDEXER_URL: "https://splunk-idx1:8089"
      SPLUNK_PASSWORD: "${SPLUNK_PASSWORD}"
      SPLUNK_SECRET: "${SPLUNK_SECRET}"
      SPLUNK_REPLICATION_FACTOR: "1"
      SPLUNK_SEARCH_FACTOR: "1"
    networks:
      - splunk-net
    volumes:
      - splunk-idx1-etc:/opt/splunk/etc
      - splunk-idx1-var:/opt/splunk/var
    profiles: ["splunk", "small", "medium", "large"]
    healthcheck:
      test: ["CMD-SHELL", "$SPLUNK_HOME/bin/splunk status || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 10
      start_period: 120s
    deploy:
      resources:
        limits:
          cpus: '${SPLUNK_INDEXER_CPU_LIMIT:-2.0}'
          memory: '${SPLUNK_INDEXER_MEM_LIMIT:-4G}'
        reservations:
          cpus: '${SPLUNK_INDEXER_CPU_RESERVE:-1.0}'
          memory: '${SPLUNK_INDEXER_MEM_RESERVE:-2G}'
    depends_on:
      splunk-cm:
        condition: service_healthy
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "5"
  # Splunk Indexer 2
  splunk-idx2:
    image: "${SPLUNK_IMAGE}"
    container_name: "${COMPOSE_PROJECT_NAME:-splunk}_splunk-idx2"
    hostname: "splunk-idx2"
    restart: unless-stopped
    ports:
      - "9998:9997"  # Splunk2Splunk
      - "8090:8088"  # HTTP Event Collector
    environment:
      SPLUNK_START_ARGS: "--accept-license --answer-yes"
      SPLUNK_GENERAL_TERMS: "--accept-sgt-current-at-splunk-com"
      SPLUNK_ROLE: "splunk_indexer"
      SPLUNK_CLUSTER_MASTER_URL: "https://splunk-cm:8089"
      SPLUNK_INDEXER_URL: "https://splunk-idx2:8089"
      SPLUNK_PASSWORD: "${SPLUNK_PASSWORD}"
      SPLUNK_SECRET: "${SPLUNK_SECRET}"
      SPLUNK_REPLICATION_FACTOR: "1"
      SPLUNK_SEARCH_FACTOR: "1"
    networks:
      - splunk-net
    volumes:
      - splunk-idx2-etc:/opt/splunk/etc
      - splunk-idx2-var:/opt/splunk/var
    profiles: ["splunk", "small", "medium", "large"]
    healthcheck:
      test: ["CMD-SHELL", "$SPLUNK_HOME/bin/splunk status || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 10
      start_period: 120s
    deploy:
      resources:
        limits:
          cpus: '${SPLUNK_INDEXER_CPU_LIMIT:-2.0}'
          memory: '${SPLUNK_INDEXER_MEM_LIMIT:-4G}'
        reservations:
          cpus: '${SPLUNK_INDEXER_CPU_RESERVE:-1.0}'
          memory: '${SPLUNK_INDEXER_MEM_RESERVE:-2G}'
    depends_on:
      splunk-cm:
        condition: service_healthy
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "5"
  # Splunk Search Head 1
  splunk-sh1:
    image: "${SPLUNK_IMAGE}"
    container_name: "${COMPOSE_PROJECT_NAME:-splunk}_splunk-sh1"
    hostname: "splunk-sh1"
    restart: unless-stopped
    ports:
      - "8000:8000"  # Splunk Web
      - "8099:8089"  # Management port
    environment:
      SPLUNK_START_ARGS: "--accept-license --answer-yes"
      SPLUNK_GENERAL_TERMS: "--accept-sgt-current-at-splunk-com"
      SPLUNK_ROLE: "splunk_search_head"
      SPLUNK_CLUSTER_MASTER_URL: "https://splunk-cm:8089"
      SPLUNK_SEARCH_HEAD_URL: "https://splunk-sh1:8089"
      SPLUNK_PASSWORD: "${SPLUNK_PASSWORD}"
      SPLUNK_SECRET: "${SPLUNK_SECRET}"
    networks:
      - splunk-net
    volumes:
      - splunk-sh1-etc:/opt/splunk/etc
      - splunk-sh1-var:/opt/splunk/var
    profiles: ["splunk", "small", "medium", "large"]
    healthcheck:
      test: ["CMD-SHELL", "curl -sf http://localhost:8000/en-US/account/login >/dev/null || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 10
      start_period: 120s
    deploy:
      resources:
        limits:
          cpus: '${SPLUNK_SEARCH_HEAD_CPU_LIMIT:-1.5}'
          memory: '${SPLUNK_SEARCH_HEAD_MEM_LIMIT:-2G}'
        reservations:
          cpus: '${SPLUNK_SEARCH_HEAD_CPU_RESERVE:-0.5}'
          memory: '${SPLUNK_SEARCH_HEAD_MEM_RESERVE:-1G}'
    depends_on:
      splunk-cm:
        condition: service_healthy
    logging:
      driver: "json-file"
      options:
        max-size: "50m"
        max-file: "5"
  # Indexer alias for deploy.sh compatibility
  indexer:
    extends:
      service: splunk-idx1
    container_name: "${COMPOSE_PROJECT_NAME:-splunk}_indexer"
    ports:
      - "9997:9997"  # Splunk2Splunk
      - "8088:8088"  # HTTP Event Collector
    profiles: ["small", "medium", "large"]

networks:
  splunk-net:
    driver: bridge
    name: "${COMPOSE_PROJECT_NAME:-splunk}_cluster_network"

volumes:
  splunk-cm-etc:
    name: "${COMPOSE_PROJECT_NAME:-splunk}_cm_etc"
  splunk-cm-var:
    name: "${COMPOSE_PROJECT_NAME:-splunk}_cm_var"
  splunk-idx1-etc:
    name: "${COMPOSE_PROJECT_NAME:-splunk}_idx1_etc"
  splunk-idx1-var:
    name: "${COMPOSE_PROJECT_NAME:-splunk}_idx1_var"
  splunk-idx2-etc:
    name: "${COMPOSE_PROJECT_NAME:-splunk}_idx2_etc"
  splunk-idx2-var:
    name: "${COMPOSE_PROJECT_NAME:-splunk}_idx2_var"
  splunk-sh1-etc:
    name: "${COMPOSE_PROJECT_NAME:-splunk}_sh1_etc"
  splunk-sh1-var:
    name: "${COMPOSE_PROJECT_NAME:-splunk}_sh1_var"
