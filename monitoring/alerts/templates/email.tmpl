# ==============================================================================
# monitoring/alerts/templates/email.tmpl
# Email notification templates for AlertManager
# ==============================================================================

{{ define "email.subject" }}
[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] Splunk Alert: {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}
{{ end }}

{{ define "email.html" }}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background-color: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { background-color: #ff6b35; color: white; padding: 20px; text-align: center; }
        .header.resolved { background-color: #28a745; }
        .content { padding: 20px; }
        .alert { border-left: 4px solid #ff6b35; padding: 15px; margin: 10px 0; background-color: #fff3f0; }
        .alert.resolved { border-left-color: #28a745; background-color: #f0fff4; }
        .alert-title { font-weight: bold; font-size: 18px; margin-bottom: 10px; }
        .alert-description { margin-bottom: 15px; line-height: 1.5; }
        .details { background-color: #f8f9fa; padding: 15px; border-radius: 4px; margin: 15px 0; }
        .label { display: inline-block; background-color: #6c757d; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px; margin: 2px; }
        .timestamp { color: #6c757d; font-size: 14px; margin-top: 10px; }
        .footer { background-color: #f8f9fa; padding: 15px; text-align: center; color: #6c757d; font-size: 14px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header{{ if eq .Status "resolved" }} resolved{{ end }}">
            <h1>
                {{ if eq .Status "firing" }}üö® ALERT FIRING{{ else }}‚úÖ ALERT RESOLVED{{ end }}
            </h1>
            <p>Splunk Cluster Monitoring</p>
        </div>
        
        <div class="content">
            <p><strong>Status:</strong> {{ .Status | toUpper }}</p>
            <p><strong>Number of alerts:</strong> {{ len .Alerts }}</p>
            
            {{ range .Alerts }}
            <div class="alert{{ if eq .Status "resolved" }} resolved{{ end }}">
                <div class="alert-title">{{ .Annotations.summary }}</div>
                <div class="alert-description">{{ .Annotations.description }}</div>
                
                <div class="details">
                    <strong>Labels:</strong><br>
                    {{ range .Labels.SortedPairs }}
                    <span class="label">{{ .Name }}: {{ .Value }}</span>
                    {{ end }}
                </div>
                
                {{ if .Annotations.runbook_url }}
                <p><strong>Runbook:</strong> <a href="{{ .Annotations.runbook_url }}">{{ .Annotations.runbook_url }}</a></p>
                {{ end }}
                
                <div class="timestamp">
                    <strong>Started:</strong> {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}<br>
                    {{ if ne .EndsAt .StartsAt }}
                    <strong>Ended:</strong> {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}
                    {{ end }}
                </div>
            </div>
            {{ end }}
        </div>
        
        <div class="footer">
            This alert was generated by AlertManager for Easy_Splunk monitoring.<br>
            Time: {{ now.Format "2006-01-02 15:04:05 UTC" }}
        </div>
    </div>
</body>
</html>
{{ end }}

{{ define "email.critical.html" }}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background-color: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border: 3px solid #dc3545; }
        .header { background-color: #dc3545; color: white; padding: 20px; text-align: center; }
        .header.resolved { background-color: #28a745; }
        .content { padding: 20px; }
        .critical-banner { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 15px; margin-bottom: 20px; border-radius: 4px; font-weight: bold; text-align: center; }
        .alert { border-left: 4px solid #dc3545; padding: 15px; margin: 10px 0; background-color: #f8d7da; }
        .alert.resolved { border-left-color: #28a745; background-color: #d4edda; }
        .alert-title { font-weight: bold; font-size: 18px; margin-bottom: 10px; color: #721c24; }
        .alert-description { margin-bottom: 15px; line-height: 1.5; }
        .impact { background-color: #fff3cd; border: 1px solid #ffeeba; padding: 15px; border-radius: 4px; margin: 15px 0; }
        .actions { background-color: #d1ecf1; border: 1px solid #bee5eb; padding: 15px; border-radius: 4px; margin: 15px 0; }
        .details { background-color: #f8f9fa; padding: 15px; border-radius: 4px; margin: 15px 0; }
        .label { display: inline-block; background-color: #dc3545; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px; margin: 2px; }
        .timestamp { color: #6c757d; font-size: 14px; margin-top: 10px; }
        .footer { background-color: #f8f9fa; padding: 15px; text-align: center; color: #6c757d; font-size: 14px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header{{ if eq .Status "resolved" }} resolved{{ end }}">
            <h1>
                {{ if eq .Status "firing" }}üö® CRITICAL ALERT{{ else }}‚úÖ CRITICAL ALERT RESOLVED{{ end }}
            </h1>
            <p>Immediate Action Required</p>
        </div>
        
        <div class="content">
            <div class="critical-banner">
                ‚ö†Ô∏è THIS IS A CRITICAL ALERT REQUIRING IMMEDIATE ATTENTION ‚ö†Ô∏è
            </div>
            
            <p><strong>Status:</strong> {{ .Status | toUpper }}</p>
            <p><strong>Critical alerts:</strong> {{ len .Alerts }}</p>
            
            {{ range .Alerts }}
            <div class="alert{{ if eq .Status "resolved" }} resolved{{ end }}">
                <div class="alert-title">üö® {{ .Annotations.summary }}</div>
                <div class="alert-description">{{ .Annotations.description }}</div>
                
                {{ if .Annotations.impact }}
                <div class="impact">
                    <strong>Impact:</strong> {{ .Annotations.impact }}
                </div>
                {{ end }}
                
                {{ if .Annotations.action }}
                <div class="actions">
                    <strong>Recommended Actions:</strong><br>
                    {{ .Annotations.action }}
                </div>
                {{ end }}
                
                <div class="details">
                    <strong>Labels:</strong><br>
                    {{ range .Labels.SortedPairs }}
                    <span class="label">{{ .Name }}: {{ .Value }}</span>
                    {{ end }}
                </div>
                
                {{ if .Annotations.runbook_url }}
                <p><strong>Runbook:</strong> <a href="{{ .Annotations.runbook_url }}" style="color: #dc3545; font-weight: bold;">{{ .Annotations.runbook_url }}</a></p>
                {{ end }}
                
                <div class="timestamp">
                    <strong>Started:</strong> {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}<br>
                    {{ if ne .EndsAt .StartsAt }}
                    <strong>Ended:</strong> {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}
                    {{ end }}
                </div>
            </div>
            {{ end }}
            
            <div class="actions">
                <strong>Next Steps:</strong>
                <ol>
                    <li>Acknowledge this alert in your monitoring system</li>
                    <li>Check the Splunk cluster status immediately</li>
                    <li>Follow the runbook procedures if available</li>
                    <li>Escalate to senior engineers if needed</li>
                    <li>Update the incident communication channels</li>
                </ol>
            </div>
        </div>
        
        <div class="footer">
            This critical alert was generated by AlertManager for Easy_Splunk monitoring.<br>
            Time: {{ now.Format "2006-01-02 15:04:05 UTC" }}
        </div>
    </div>
</body>
</html>
{{ end }}

{{ define "email.cluster_master.html" }}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background-color: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border: 3px solid #dc3545; }
        .header { background: linear-gradient(135deg, #dc3545, #c82333); color: white; padding: 20px; text-align: center; }
        .content { padding: 20px; }
        .urgent-banner { background-color: #f8d7da; border: 2px solid #dc3545; color: #721c24; padding: 20px; margin-bottom: 20px; border-radius: 8px; font-weight: bold; text-align: center; font-size: 18px; }
        .impact-section { background-color: #fff3cd; border: 2px solid #ffc107; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .action-section { background-color: #d1ecf1; border: 2px solid #17a2b8; padding: 20px; border-radius: 8px; margin: 20px 0; }
        .alert { border-left: 4px solid #dc3545; padding: 15px; margin: 10px 0; background-color: #f8d7da; }
        .details { background-color: #f8f9fa; padding: 15px; border-radius: 4px; margin: 15px 0; }
        .label { display: inline-block; background-color: #dc3545; color: white; padding: 3px 8px; border-radius: 12px; font-size: 12px; margin: 2px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üö® CLUSTER MASTER DOWN</h1>
            <p>URGENT: Immediate Action Required</p>
        </div>
        
        <div class="content">
            <div class="urgent-banner">
                ‚ö†Ô∏è SPLUNK CLUSTER MASTER IS DOWN - CLUSTER COORDINATION AFFECTED ‚ö†Ô∏è
            </div>
            
            <div class="impact-section">
                <h3>üî¥ IMMEDIATE IMPACT:</h3>
                <ul>
                    <li><strong>Cluster Coordination:</strong> No central management of indexer cluster</li>
                    <li><strong>Data Replication:</strong> Bucket replication may be affected</li>
                    <li><strong>Indexer Management:</strong> Cannot add/remove indexers</li>
                    <li><strong>Search Coordination:</strong> Distributed searches may fail</li>
                    <li><strong>Configuration Distribution:</strong> Cannot push cluster configurations</li>
                </ul>
            </div>
            
            <div class="action-section">
                <h3>‚ö° IMMEDIATE ACTIONS REQUIRED:</h3>
                <ol>
                    <li><strong>Check cluster master status:</strong> SSH into cluster master node</li>
                    <li><strong>Verify Splunk process:</strong> Check if splunkd is running</li>
                    <li><strong>Check system resources:</strong> CPU, memory, disk space</li>
                    <li><strong>Review logs:</strong> Check splunkd.log for errors</li>
                    <li><strong>Restart if needed:</strong> Try restarting Splunk service</li>
                    <li><strong>Escalate if persistent:</strong> Contact senior Splunk administrators</li>
                </ol>
            </div>
            
            {{ range .Alerts }}
            <div class="alert">
                <h3>{{ .Annotations.summary }}</h3>
                <p>{{ .Annotations.description }}</p>
                
                <div class="details">
                    <strong>Alert Details:</strong><br>
                    {{ range .Labels.SortedPairs }}
                    <span class="label">{{ .Name }}: {{ .Value }}</span>
                    {{ end }}
                </div>
                
                <p><strong>Alert Time:</strong> {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}</p>
            </div>
            {{ end }}
            
            <div class="action-section">
                <h3>üìû ESCALATION CONTACTS:</h3>
                <ul>
                    <li><strong>Primary:</strong> Splunk Admin Team</li>
                    <li><strong>Secondary:</strong> Infrastructure Team</li>
                    <li><strong>Emergency:</strong> On-call Engineer</li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>
{{ end }}

{{ define "email.security.html" }}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background-color: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border: 3px solid #e74c3c; }
        .header { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; padding: 20px; text-align: center; }
        .content { padding: 20px; }
        .security-banner { background-color: #fadbd8; border: 2px solid #e74c3c; color: #922b21; padding: 20px; margin-bottom: 20px; border-radius: 8px; font-weight: bold; text-align: center; font-size: 18px; }
        .alert { border-left: 4px solid #e74c3c; padding: 15px; margin: 10px 0; background-color: #fadbd8; }
        .threat-level { background-color: #f8d7da; border: 2px solid #dc3545; padding: 15px; border-radius: 8px; margin: 15px 0; }
        .response-section { background-color: #d4edda; border: 2px solid #28a745; padding: 20px; border-radius: 8px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è SECURITY ALERT</h1>
            <p>Splunk Security Monitoring</p>
        </div>
        
        <div class="content">
            <div class="security-banner">
                ‚ö†Ô∏è SECURITY INCIDENT DETECTED IN SPLUNK ENVIRONMENT ‚ö†Ô∏è
            </div>
            
            {{ range .Alerts }}
            <div class="alert">
                <h3>üõ°Ô∏è {{ .Annotations.summary }}</h3>
                <p>{{ .Annotations.description }}</p>
                
                {{ if .Labels.threat_level }}
                <div class="threat-level">
                    <strong>Threat Level:</strong> {{ .Labels.threat_level | toUpper }}
                </div>
                {{ end }}
                
                <p><strong>Detection Time:</strong> {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}</p>
            </div>
            {{ end }}
            
            <div class="response-section">
                <h3>üîí SECURITY RESPONSE CHECKLIST:</h3>
                <ul>
                    <li>‚ñ° Acknowledge security alert</li>
                    <li>‚ñ° Assess threat severity</li>
                    <li>‚ñ° Check for indicators of compromise</li>
                    <li>‚ñ° Review authentication logs</li>
                    <li>‚ñ° Verify user access patterns</li>
                    <li>‚ñ° Check for unauthorized configuration changes</li>
                    <li>‚ñ° Document incident details</li>
                    <li>‚ñ° Escalate to security team if needed</li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>
{{ end }}
