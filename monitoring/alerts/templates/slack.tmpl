# ==============================================================================
# monitoring/alerts/templates/slack.tmpl
# Slack notification templates for AlertManager
# ==============================================================================

{{ define "slack.title" }}
{{ if eq .Status "firing" }}ğŸš¨ Splunk Alert{{ else }}âœ… Resolved{{ end }}: {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}
{{ end }}

{{ define "slack.text" }}
{{ if eq .Status "firing" }}
âš ï¸ *Alert Status:* FIRING
ğŸ”¥ *Active Alerts:* {{ len .Alerts }}
{{ else }}
âœ… *Alert Status:* RESOLVED
ğŸ‰ *Resolved Alerts:* {{ len .Alerts }}
{{ end }}

{{ range .Alerts }}
*{{ .Annotations.summary }}*
{{ .Annotations.description }}

*Labels:*
{{ range .Labels.SortedPairs }}â€¢ {{ .Name }}: `{{ .Value }}`
{{ end }}
{{ if .Annotations.runbook_url }}
ğŸ“– *Runbook:* {{ .Annotations.runbook_url }}
{{ end }}
â° *Started:* {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
{{ if ne .EndsAt .StartsAt }}â° *Ended:* {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}{{ end }}
---
{{ end }}
{{ end }}

{{ define "slack.critical.title" }}
ğŸš¨ CRITICAL SPLUNK ALERT
{{ end }}

{{ define "slack.critical.text" }}
ğŸš¨ *CRITICAL ALERT - IMMEDIATE ACTION REQUIRED*

{{ if eq .Status "firing" }}
ğŸ”¥ *Critical Alerts Firing:* {{ len .Alerts }}
{{ else }}
âœ… *Critical Alerts Resolved:* {{ len .Alerts }}
{{ end }}

{{ range .Alerts }}
ğŸš¨ *{{ .Annotations.summary }}*
{{ .Annotations.description }}

{{ if .Annotations.impact }}âš ï¸ *Impact:* {{ .Annotations.impact }}{{ end }}
{{ if .Annotations.action }}âš¡ *Action Required:* {{ .Annotations.action }}{{ end }}

*Alert Details:*
{{ range .Labels.SortedPairs }}â€¢ {{ .Name }}: `{{ .Value }}`
{{ end }}
{{ if .Annotations.runbook_url }}
ğŸ“– *Runbook:* {{ .Annotations.runbook_url }}
{{ end }}
â° *Started:* {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
{{ if ne .EndsAt .StartsAt }}â° *Ended:* {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}{{ end }}
---
{{ end }}

*Next Steps:*
1. ğŸ” Acknowledge alert in monitoring system
2. ğŸ› ï¸ Check Splunk cluster status immediately
3. ğŸ“š Follow runbook procedures
4. ğŸ“ Escalate if needed
{{ end }}

{{ define "slack.security.text" }}
ğŸ›¡ï¸ *SECURITY ALERT DETECTED*

{{ if eq .Status "firing" }}
âš ï¸ *Security Alerts:* {{ len .Alerts }} active
{{ else }}
âœ… *Security Alerts:* {{ len .Alerts }} resolved
{{ end }}

{{ range .Alerts }}
ğŸ”’ *{{ .Annotations.summary }}*
{{ .Annotations.description }}

{{ if .Labels.threat_level }}ğŸš¨ *Threat Level:* {{ .Labels.threat_level | toUpper }}{{ end }}
{{ if .Labels.source_ip }}ğŸŒ *Source IP:* {{ .Labels.source_ip }}{{ end }}
{{ if .Labels.user }}ğŸ‘¤ *User:* {{ .Labels.user }}{{ end }}

*Security Context:*
{{ range .Labels.SortedPairs }}â€¢ {{ .Name }}: `{{ .Value }}`
{{ end }}
â° *Detection Time:* {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
---
{{ end }}

ğŸ” *Security Response Required:*
â€¢ Check authentication logs
â€¢ Verify user access patterns
â€¢ Review configuration changes
â€¢ Escalate to security team
{{ end }}

{{ define "slack.license.text" }}
ğŸ“„ *LICENSE ALERT*

{{ if eq .Status "firing" }}
âš ï¸ *License Issues:* {{ len .Alerts }} active
{{ else }}
âœ… *License Issues:* {{ len .Alerts }} resolved
{{ end }}

{{ range .Alerts }}
ğŸ“‹ *{{ .Annotations.summary }}*
{{ .Annotations.description }}

{{ if .Labels.license_pool }}ğŸ“Š *License Pool:* {{ .Labels.license_pool }}{{ end }}
{{ if .Labels.usage_percent }}ğŸ“ˆ *Usage:* {{ .Labels.usage_percent }}%{{ end }}

*License Details:*
{{ range .Labels.SortedPairs }}â€¢ {{ .Name }}: `{{ .Value }}`
{{ end }}
â° *Alert Time:* {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
---
{{ end }}

ğŸ’¡ *License Actions:*
â€¢ Check current license usage
â€¢ Review data ingestion patterns
â€¢ Consider license optimization
â€¢ Contact license administrator
{{ end }}

{{ define "slack.resource.text" }}
ğŸ“Š *RESOURCE ALERT*

{{ if eq .Status "firing" }}
âš ï¸ *Resource Issues:* {{ len .Alerts }} active
{{ else }}
âœ… *Resource Issues:* {{ len .Alerts }} resolved
{{ end }}

{{ range .Alerts }}
ğŸ“ˆ *{{ .Annotations.summary }}*
{{ .Annotations.description }}

{{ if .Labels.resource_type }}ğŸ”§ *Resource:* {{ .Labels.resource_type }}{{ end }}
{{ if .Labels.usage_percent }}ğŸ“Š *Usage:* {{ .Labels.usage_percent }}%{{ end }}
{{ if .Labels.threshold }}âš ï¸ *Threshold:* {{ .Labels.threshold }}{{ end }}

*Resource Details:*
{{ range .Labels.SortedPairs }}â€¢ {{ .Name }}: `{{ .Value }}`
{{ end }}
â° *Alert Time:* {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
---
{{ end }}

ğŸ› ï¸ *Resource Actions:*
â€¢ Check system utilization
â€¢ Review resource allocation
â€¢ Consider scaling options
â€¢ Monitor trends
{{ end }}

{{ define "slack.performance.text" }}
âš¡ *PERFORMANCE ALERT*

{{ if eq .Status "firing" }}
âš ï¸ *Performance Issues:* {{ len .Alerts }} active
{{ else }}
âœ… *Performance Issues:* {{ len .Alerts }} resolved
{{ end }}

{{ range .Alerts }}
ğŸ” *{{ .Annotations.summary }}*
{{ .Annotations.description }}

{{ if .Labels.search_type }}ğŸ” *Search Type:* {{ .Labels.search_type }}{{ end }}
{{ if .Labels.response_time }}â±ï¸ *Response Time:* {{ .Labels.response_time }}s{{ end }}
{{ if .Labels.queue_depth }}ğŸ“Š *Queue Depth:* {{ .Labels.queue_depth }}{{ end }}

*Performance Details:*
{{ range .Labels.SortedPairs }}â€¢ {{ .Name }}: `{{ .Value }}`
{{ end }}
â° *Alert Time:* {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
---
{{ end }}

ğŸš€ *Performance Actions:*
â€¢ Check search queue status
â€¢ Review search head load
â€¢ Optimize search queries
â€¢ Monitor system resources
{{ end }}

{{ define "slack.info.text" }}
â„¹ï¸ *INFORMATION ALERT*

{{ if eq .Status "firing" }}
ğŸ“¢ *Info Notifications:* {{ len .Alerts }} active
{{ else }}
âœ… *Info Notifications:* {{ len .Alerts }} cleared
{{ end }}

{{ range .Alerts }}
ğŸ“ *{{ .Annotations.summary }}*
{{ .Annotations.description }}

*Information Details:*
{{ range .Labels.SortedPairs }}â€¢ {{ .Name }}: `{{ .Value }}`
{{ end }}
â° *Notification Time:* {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
---
{{ end }}
{{ end }}

{{ define "slack.alert_details.text" }}
*Alert Details:*
{{ range .Alerts }}
â€¢ *Alert:* {{ .Annotations.summary }}
â€¢ *Status:* {{ .Status }}
â€¢ *Severity:* {{ .Labels.severity }}
{{ if .Labels.instance }}â€¢ *Instance:* {{ .Labels.instance }}{{ end }}
{{ if .Labels.service }}â€¢ *Service:* {{ .Labels.service }}{{ end }}
{{ if .Labels.cluster }}â€¢ *Cluster:* {{ .Labels.cluster }}{{ end }}
â€¢ *Started:* {{ .StartsAt.Format "15:04:05 UTC" }}
{{ end }}
{{ end }}
